<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Color Ratio Example</title>
    <style>
      :root {
        /* 初期カラー */
        --accent-color: #738fe2;
        --main-color: #e8f7ff;
      }

      body {
        font-family: sans-serif;
        padding: 20px;
        background-color: var(--main-color);
        color: var(--accent-color);
        transition: background-color 0.3s, color 0.3s;
      }

      .preview {
        display: flex;
        gap: 20px;
        margin-top: 20px;
      }

      .box {
        width: 150px;
        height: 150px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2em;
        font-weight: bold;
        color: white;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.4);
      }

      .accent-box {
        background-color: var(--accent-color);
      }

      .main-box {
        background-color: var(--main-color);
        /* main-colorは明るいので文字色を濃くする */
        color: #333;
        border: 2px solid var(--accent-color);
      }

      input[type="color"] {
        width: 100px;
        height: 50px;
        border: none;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>Color Ratio Example</h1>
    <p>アクセントカラーを変更すると、メインカラーが自動的に更新されます。</p>

    <label for="accentColorPicker">Accent Color:</label>
    <input type="color" id="accentColorPicker" value="#738fe2" />

    <div class="preview">
      <div class="box accent-box">Accent</div>
      <div class="box main-box">Main</div>
    </div>

    <script>
      // HSLの差分（この値を調整すると関係性が変わる）
      const HUE_DIFF = -23;
      const SATURATION_DIFF = 31;
      const LIGHTNESS_DIFF = 28;

      const accentColorPicker = document.getElementById("accentColorPicker");

      accentColorPicker.addEventListener("input", (event) => {
        const newAccentColorHex = event.target.value;

        // 1. 新しいアクセントカラーをCSS変数に設定
        document.documentElement.style.setProperty(
          "--accent-color",
          newAccentColorHex
        );

        // 2. 新しいメインカラーを計算して設定
        const newAccentHsl = hexToHsl(newAccentColorHex);

        // HSL差分を適用
        let mainHue = (newAccentHsl.h + HUE_DIFF + 360) % 360;
        let mainSaturation = Math.max(
          0,
          Math.min(100, newAccentHsl.s + SATURATION_DIFF)
        );
        let mainLightness = Math.max(
          0,
          Math.min(100, newAccentHsl.l + LIGHTNESS_DIFF)
        );

        const newMainColorHex = hslToHex(
          mainHue,
          mainSaturation,
          mainLightness
        );

        document.documentElement.style.setProperty(
          "--main-color",
          newMainColorHex
        );
      });

      /* --- 色変換用のヘルパー関数 --- */

      function hexToHsl(hex) {
        let r = parseInt(hex.substring(1, 3), 16) / 255;
        let g = parseInt(hex.substring(3, 5), 16) / 255;
        let b = parseInt(hex.substring(5, 7), 16) / 255;

        let max = Math.max(r, g, b),
          min = Math.min(r, g, b);
        let h,
          s,
          l = (max + min) / 2;

        if (max === min) {
          h = s = 0; // achromatic
        } else {
          let d = max - min;
          s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
          switch (max) {
            case r:
              h = (g - b) / d + (g < b ? 6 : 0);
              break;
            case g:
              h = (b - r) / d + 2;
              break;
            case b:
              h = (r - g) / d + 4;
              break;
          }
          h /= 6;
        }
        return {
          h: Math.round(h * 360),
          s: Math.round(s * 100),
          l: Math.round(l * 100),
        };
      }

      function hslToHex(h, s, l) {
        l /= 100;
        const a = (s * Math.min(l, 1 - l)) / 100;
        const f = (n) => {
          const k = (n + h / 30) % 12;
          const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
          return Math.round(255 * color)
            .toString(16)
            .padStart(2, "0");
        };
        return `#${f(0)}${f(8)}${f(4)}`;
      }
    </script>
  </body>
</html>
